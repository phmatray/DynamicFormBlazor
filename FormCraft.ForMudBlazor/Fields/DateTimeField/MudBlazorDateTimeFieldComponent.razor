@namespace FormCraft.ForMudBlazor
@typeparam TModel
@inherits FieldComponentBase<TModel, DateTime>
@implements IDateTimeFieldComponent<TModel>

<MudDatePicker Label="@Label"
               Date="@DateValue"
               DateChanged="@HandleDateChanged"
               Placeholder="@Placeholder"
               HelperText="@HelpText"
               ReadOnly="@IsReadOnly"
               Disabled="@IsDisabled"
               Required="@IsRequired"
               Variant="Variant.Outlined"
               Margin="Margin.Dense"
               DateFormat="@Format"
               Editable="true"
               MinDate="@MinDate"
               MaxDate="@MaxDate"
               Clearable="@ShowClearButton"
               AutoClose="@(!OpenOnFocus)" />

@code {
    public DateTimeInputMode InputMode { get; set; } = DateTimeInputMode.Date;
    public string? Format { get; set; } = "yyyy-MM-dd";
    public DateTime? MinDate { get; set; }
    public DateTime? MaxDate { get; set; }
    public bool ShowClearButton { get; set; } = true;
    public bool OpenOnFocus { get; set; } = true;
    
    private DateTime? DateValue => CurrentValue == default ? null : CurrentValue;
    
    protected override void OnInitialized()
    {
        base.OnInitialized();
        
        // Load configuration from additional attributes
        InputMode = GetAttribute("InputMode", DateTimeInputMode.Date);
        Format = GetAttribute("Format", "yyyy-MM-dd");
        MinDate = GetAttribute<DateTime?>("MinDate");
        MaxDate = GetAttribute<DateTime?>("MaxDate");
        ShowClearButton = GetAttribute("ShowClearButton", true);
        OpenOnFocus = GetAttribute("OpenOnFocus", true);
    }
    
    private void HandleDateChanged(DateTime? date)
    {
        CurrentValue = date ?? default;
    }
}